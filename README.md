# Асинхронный калькулятор выражений

Этот проект представляет собой асинхронный калькулятор, который позволяет вычислять арифметические выражения в распределенной системе. Вычисления выполняются с использованием оркестратора и агентов, что позволяет масштабировать систему и выполнять операции параллельно.

P.S: для связи со мной, тг <a>https://t.me/bomboklyat</a>, если нашли ошибку или есть фитбек то пишите :)

## Архитектура
![Иллюстрация к проекту](https://github.com/EgorjanPy/finalProject/blob/main/Screenshot_1.png)


Проект состоит из двух основных компонентов:
1. Оркестратор:
    - Сервер, который принимает арифметические выражения, разбивает их на задачи и управляет их выполнением.
    - Предоставляет API для добавления выражений, получения статуса и результатов вычислений.

2. Агент:
    - Демон, который получает задачи от оркестратора, выполняет вычисления и возвращает результаты.
    - Может запускать несколько горутин для параллельного выполнения задач.

## API Оркестратора
1. Добавление выражения для вычисления

Запрос:
- ручка `localhost/api/v1/calculate`
```
    curl --location 'localhost:8080/api/v1/calculate' \
    --header 'Content-Type: application/json' \
    --data '{
    "expression": "2 + 2 * 2"
    }'
```
Ответ:
- Код ответа: `201` (выражение принято), `422` (невалидные данные), `500` (ошибка сервера).<br/>
- Тело ответа:
```
{
    "id": 1
}
```
2. Получение списка выражений

Запрос:
```
curl --location 'localhost:8080/api/v1/expressions'
```
Ответ:
- Код ответа: `200` (успешно), `500` (ошибка сервера).
- Тело ответа:
```
{
    "expressions": [
        {
            "id": 1,
            "status": "completed",
            "result": 6
        },
        {
            "id": 2,
            "status": "processing",
            "result": null
        }
    ]
}
```
3. Получение выражения по ID

Запрос:
```
curl --location 'localhost:8080/api/v1/expressions/1'
```
Ответ:
- Код ответа: `200` (успешно), `404` (выражение не найдено), `500` (ошибка сервера).
- Тело ответа:
```
{
    "expression": {
        "id": 1,
        "status": "completed",
        "result": 6
    }
}
```
4. Получение задачи для выполнения (для агентов)

Запрос:
```
curl --location 'localhost:8080/internal/task'
```
Ответ:
- Код ответа: `200` (успешно), `404` (нет задач), `500` (ошибка сервера).
- Тело ответа:
```
{
    "task": {
        "id": 1,
        "arg1": 2,
        "arg2": 2,
        "operation": "+",
        "operation_time": 1000
    }
}
```
5. Отправка результата выполнения задачи (для агентов)

Запрос:
```
curl --location 'localhost:8080/internal/task' \
--header 'Content-Type: application/json' \
--data '{
  "id": 1,
  "result": 4
}'
```
Ответ:
- Код ответа: `200` (успешно), `404` (задача не найдена), `422` (невалидные данные), `500` (ошибка сервера).

## Настройка времени выполнения операций
Время выполнения операций задается через переменные конфига (в миллисекундах):

- `TIME_ADDITION_MS` — время выполнения сложения.

- `TIME_SUBTRACTION_MS` — время выполнения вычитания.

- `TIME_MULTIPLICATIONS_MS` — время выполнения умножения.

- `TIME_DIVISIONS_MS` — время выполнения деления.
## Агент
Агент — это демон, который:
1. Запускает несколько горутин для параллельного выполнения задач.
2. Регулярно запрашивает задачи у оркестратора.
3. Выполняет вычисления и отправляет результаты обратно.
Количество горутин регулируется переменной конфига `COMPUTING_POWER`.


## Установка
* Скачайте с официального сайта [golang](https://go.dev/dl/) на ваш компьютер если он не скачен
* Клонируйте репозиторий
```
git clone https://github.com/EgorjanPy/finalProject.git
```
* Перейдите в папку репозитория
```
cd ./finalProject/
```
* Выполните команду
```
go mod tidy
```
## Запуск
Чтобы запустить оркестратор, введите команду в терминал
```
go run ./cmd/orchestrator/main.go
```
Чтобы запустить агент, введите команду в терминал
```
go run ./cmd/agent/main.go
```
Вы можете выбрать другой порт запуска через конфиг если хотите(по умолчанию 8080) 

Файл конфига находится в `finalProject/config/config.yaml`
